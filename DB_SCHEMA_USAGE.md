# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ ChatBot

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –¢–∞–±–ª–∏—Ü–∞ `places` (–ú–µ—Å—Ç–∞)

```sql
- id (bigint, primary key)
- category_id (bigint, foreign key ‚Üí categories.id)
- name_ru, name_en, name_kz (text)
- description_ru, description_en, description_kz (text)
- lat, lng (double precision)
- legends_ru, legends_en, legends_kz (text)
- inmap_url (text)
```

### 2. –¢–∞–±–ª–∏—Ü–∞ `tours` (–¢—É—Ä—ã)

```sql
- id (serial, primary key)
- company (text)
- price (integer)
- instagram_url (text)
- name_ru, name_en, name_kz (text)
- description_ru, description_en, description_kz (text)
```

### 3. –¢–∞–±–ª–∏—Ü–∞ `categories` (–ö–∞—Ç–µ–≥–æ—Ä–∏–∏)

```sql
- id (bigint, primary key)
- name_ru, name_en, name_kz (text)
```

### 4. –¢–∞–±–ª–∏—Ü–∞ `tour_places` (–°–≤—è–∑—å —Ç—É—Ä—ã-–º–µ—Å—Ç–∞)

```sql
- id (serial, primary key)
- tour_id (integer, foreign key ‚Üí tours.id)
- place_id (integer, foreign key ‚Üí places.id)
- position (integer)
```

### 5. –¢–∞–±–ª–∏—Ü–∞ `users` (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

```sql
- id (uuid, primary key, foreign key ‚Üí auth.users.id)
- full_name (text)
- created_at, updated_at (timestamp)
```

---

## üîß –ú–µ—Ç–æ–¥—ã DataService

### –ú–µ—Å—Ç–∞ (Places)

#### `getAllPlaces()`

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –º–µ—Å—Ç–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö (JOIN —Å `categories`).

```javascript
const places = await dataService.getAllPlaces();
```

#### `getPlacesByCategory(categoryId)`

–ü–æ–ª—É—á–∞–µ—Ç –º–µ—Å—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

```javascript
const places = await dataService.getPlacesByCategory(1);
```

#### `searchPlaces(query, language)`

–ü–æ–∏—Å–∫ –º–µ—Å—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é.

```javascript
const places = await dataService.searchPlaces("–®–µ—Ä–∫–∞–ª–∞", "ru");
```

#### `getPlaceById(placeId)`

–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ –ø–æ ID.

```javascript
const place = await dataService.getPlaceById(123);
```

#### `getPopularPlaces(limit)`

–ü–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä–≤—ã–µ N –º–µ—Å—Ç (—Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—è rating –Ω–µ—Ç).

```javascript
const popular = await dataService.getPopularPlaces(5);
```

#### `getPlacesWithLegends()`

–ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –º–µ—Å—Ç–∞, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –ª–µ–≥–µ–Ω–¥—ã.

```javascript
const placesWithLegends = await dataService.getPlacesWithLegends();
```

---

### –¢—É—Ä—ã (Tours)

#### `getAllTours()`

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Ç—É—Ä—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ—Å—Ç–∞—Ö (JOIN —Å `tour_places` –∏ `places`).

```javascript
const tours = await dataService.getAllTours();
```

–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –æ–±—ä–µ–∫—Ç —Ç—É—Ä–∞ –≤–∫–ª—é—á–∞–µ—Ç:

```javascript
{
  id: 1,
  name_ru: "–¢—É—Ä –ø–æ –ú–∞–Ω–≥–∏—Å—Ç–∞—É",
  company: "Mangystau Tour",
  price: 50000,
  tour_places: [
    {
      position: 1,
      places: {
        id: 1,
        name_ru: "–®–µ—Ä–∫–∞–ª–∞",
        name_en: "Sherkala",
        name_kz: "–®–µ—Ä–∫–∞–ª–∞"
      }
    },
    // ...
  ]
}
```

#### `getTourById(tourId)`

–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç—É—Ä –ø–æ ID.

```javascript
const tour = await dataService.getTourById(1);
```

#### `getToursByCompany(companyName)`

–ü–æ–ª—É—á–∏—Ç—å —Ç—É—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏.

```javascript
const tours = await dataService.getToursByCompany("Mangystau Tour");
```

---

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (Categories)

#### `getAllCategories()`

–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

```javascript
const categories = await dataService.getAllCategories();
```

#### `findCategoryByKeyword(keyword, language)`

–ù–∞—Ö–æ–¥–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É.

```javascript
const category = await dataService.findCategoryByKeyword("–∏—Å—Ç–æ—Ä–∏—è", "ru");
// –í–µ—Ä–Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å–æ–¥–µ—Ä–∂–∞—â–∏–º "–∏—Å—Ç–æ—Ä–∏—è"
```

---

## ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å, —Å–∏—Å—Ç–µ–º–∞:

1. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å** (`analyzeUserQuery`)
2. **–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö** (–º–µ—Å—Ç–∞/—Ç—É—Ä—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
3. **–ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î**
4. **–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–ª—è AI** (`formatPlacesForAI`, `formatToursForAI`)
5. **–ü–µ—Ä–µ–¥–∞–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç AI**

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

#### –ó–∞–ø—Ä–æ—Å: "–ü–æ–∫–∞–∂–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞"

1. –ê–Ω–∞–ª–∏–∑: —Ç–∏–ø="places", –∫–∞—Ç–µ–≥–æ—Ä–∏—è="historical"
2. –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: `findCategoryByKeyword("–∏—Å—Ç–æ—Ä–∏", "ru")`
3. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Å—Ç: `getPlacesByCategory(category.id)`
4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è AI:

```
–î–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
1. –ë–µ–∫–µ—Ç-–ê—Ç–∞: –ü–æ–¥–∑–µ–º–Ω–∞—è –º–µ—á–µ—Ç—å –≤ –º–µ–ª–æ–≤–æ–π –≥–æ—Ä–µ...
2. –®–æ–ø–∞–Ω-–ê—Ç–∞: –ù–µ–∫—Ä–æ–ø–æ–ª—å —Å –¥—Ä–µ–≤–Ω–∏–º–∏ –º–∞–≤–∑–æ–ª–µ—è–º–∏...
3. –§–æ—Ä—Ç –®–µ–≤—á–µ–Ω–∫–æ: –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä—Ç 19 –≤–µ–∫–∞...
```

5. AI –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç

#### –ó–∞–ø—Ä–æ—Å: "–ö–∞–∫–∏–µ —Ç—É—Ä—ã –µ—Å—Ç—å?"

1. –ê–Ω–∞–ª–∏–∑: —Ç–∏–ø="tours"
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—É—Ä–æ–≤: `getAllTours()`
3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```
–î–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
1. –¢—É—Ä –ø–æ –ú–∞–Ω–≥–∏—Å—Ç–∞—É (Mangystau Tour): –≠–∫—Å–∫—É—Ä—Å–∏—è –ø–æ –≤—Å–µ–º –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º... –ú–µ—Å—Ç–∞: –®–µ—Ä–∫–∞–ª–∞, –ë–æ–∑–∂—ã—Ä–∞, –¢—É–∑–±–∞–∏—Ä. –¶–µ–Ω–∞: 50000 —Ç–≥
2. –°–∞—Ñ–∞—Ä–∏ –ø–æ —Å—Ç–µ–ø–∏ (Adventure Kazakhstan): –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥–µ... –ú–µ—Å—Ç–∞: –£—Å—Ç—é—Ä—Ç, –®–µ—Ä–∫–∞–ª–∞. –¶–µ–Ω–∞: 35000 —Ç–≥
```

---

## üí° –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è AI

### `formatPlacesForAI(places, language)`

–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –º–µ—Å—Ç –≤ —Ç–µ–∫—Å—Ç –¥–ª—è AI:

```javascript
const formatted = dataService.formatPlacesForAI(places, "ru");
// "1. –®–µ—Ä–∫–∞–ª–∞: –£–¥–∏–≤–∏—Ç–µ–ª—å–Ω–∞—è –≥–æ—Ä–∞ –≤ —Ñ–æ—Ä–º–µ —é—Ä—Ç—ã...
//  2. –ë–æ–∑–∂—ã—Ä–∞: –ë–µ–ª—ã–µ —Å–∫–∞–ª—ã –∏ –∫–∞–Ω—å–æ–Ω—ã..."
```

### `formatToursForAI(tours, language)`

–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ —Ç—É—Ä–æ–≤ –≤ —Ç–µ–∫—Å—Ç –¥–ª—è AI:

```javascript
const formatted = dataService.formatToursForAI(tours, "ru");
// "1. –¢—É—Ä –ø–æ –ú–∞–Ω–≥–∏—Å—Ç–∞—É (Mangystau Tour): –≠–∫—Å–∫—É—Ä—Å–∏—è... –ú–µ—Å—Ç–∞: –®–µ—Ä–∫–∞–ª–∞, –ë–æ–∑–∂—ã—Ä–∞. –¶–µ–Ω–∞: 50000 —Ç–≥
//  2. –°–∞—Ñ–∞—Ä–∏ (Adventure): –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ... –ú–µ—Å—Ç–∞: –£—Å—Ç—é—Ä—Ç. –¶–µ–Ω–∞: 35000 —Ç–≥"
```

---

## üîç –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö:

### –ú–µ—Å—Ç–∞:

- **–†—É—Å—Å–∫–∏–π**: –º–µ—Å—Ç–æ, –º–µ—Å—Ç–∞, –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç, –ø–æ—Å–µ—Ç–∏—Ç—å
- **–ö–∞–∑–∞—Ö—Å–∫–∏–π**: –æ—Ä—ã–Ω, –∫”©—Ä—ñ–∫—Ç—ñ
- **–ê–Ω–≥–ª–∏–π—Å–∫–∏–π**: place, attraction

### –¢—É—Ä—ã:

- **–†—É—Å—Å–∫–∏–π**: —Ç—É—Ä, —Ç—É—Ä—ã, —ç–∫—Å–∫—É—Ä—Å–∏—è, –º–∞—Ä—à—Ä—É—Ç
- **–ö–∞–∑–∞—Ö—Å–∫–∏–π**: —Ç—É—Ä
- **–ê–Ω–≥–ª–∏–π—Å–∫–∏–π**: tour, route

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:

- **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ**: –ø–æ–ø—É–ª—è—Ä–Ω, –∏–∑–≤–µ—Å—Ç–Ω, –ª—É—á—à, popular, best, top
- **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ**: –∏—Å—Ç–æ—Ä–∏, –∏—Å—Ç–æ—Ä–∏—è, historical, —Ç–∞—Ä–∏—Ö–∏
- **–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ**: –ø—Ä–∏—Ä–æ–¥, nature, —Ç–∞–±–∏“ì–∏, –ø–µ–π–∑–∞–∂

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:

1. **JOIN –∑–∞–ø—Ä–æ—Å—ã** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
2. **–ò–Ω–¥–µ–∫—Å—ã** - –Ω–∞ –ø–æ–ª—è—Ö `lat`, `lng` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
3. **Limit** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

### –ü—Ä–∏–º–µ—Ä—ã JOIN –∑–∞–ø—Ä–æ—Å–æ–≤:

```sql
-- –ú–µ—Å—Ç–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
SELECT places.*, categories.*
FROM places
LEFT JOIN categories ON places.category_id = categories.id

-- –¢—É—Ä—ã —Å –º–µ—Å—Ç–∞–º–∏
SELECT tours.*, tour_places.*, places.*
FROM tours
LEFT JOIN tour_places ON tours.id = tour_places.tour_id
LEFT JOIN places ON tour_places.place_id = places.id
ORDER BY tour_places.position
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `name_*` –≤–º–µ—Å—Ç–æ `title_*`
2. ‚úÖ **Foreign Keys** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å `category_id` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏
3. ‚úÖ **JOIN –∑–∞–ø—Ä–æ—Å—ã** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ru/kz/en –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
5. ‚úÖ **–õ–µ–≥–µ–Ω–¥—ã** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –ª–µ–≥–µ–Ω–¥ –Ω–∞ –∫–∞–∂–¥–æ–º —è–∑—ã–∫–µ
6. ‚úÖ **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** - –ø–æ–ª—è `lat`, `lng` –¥–ª—è –∫–∞—Ä—Ç—ã
7. ‚úÖ **–°–≤—è–∑—å —Ç—É—Ä-–º–µ—Å—Ç–∞** - —Ç–∞–±–ª–∏—Ü–∞ `tour_places` —Å –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
8. ‚úÖ **Instagram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø–æ–ª–µ `instagram_url` –¥–ª—è —Ç—É—Ä–æ–≤

---

## üéØ –†–µ–∑—é–º–µ

–í—Å—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å **—Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**:

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π (`name_*`, –∞ –Ω–µ `title_*`)
- –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è foreign keys (`category_id`)
- JOIN –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI —á–∞—Ç-–±–æ—Ç–æ–º

